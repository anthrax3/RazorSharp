@using WebMatrix.Data;
@{
    Page.Title = "Admin :: All Widgets";
    Page.Heading = "All Widgets";
    var Message = string.Empty;

    //delete record
    var DeleteID = Request["id"];
    if (!DeleteID.IsEmpty())
    {
        using (var Db = Database.Open(Functions.GetDBName()))
        {
            var SqlDelete = "Delete From Widgets Where Id=@0";
            Db.Execute(SqlDelete, DeleteID);
            Response.Redirect("~/Admin/AllWidgets?messageId=1");
        }
    }
    //show success messages
    var messageId = Request["messageId"];
    if (!messageId.IsEmpty())
    {
        switch (messageId)
        {
            case "1":
                Message = Helpers.alertSuccess("Widget successeffully deleted!");
                break;
            default:
                Message = Helpers.alertWarning("Unknown messageId");
                break;
        }
    }
    IEnumerable<dynamic> Data = Enumerable.Empty<dynamic>();
    using (var Db = Database.Open(Functions.GetDBName()))
    {
        var SqlSelect = "Select Id, wName, wEditDate, wFile From Widgets Order By wEditDate DESC";
        Data = Db.Query(SqlSelect);
    }
    var Grid = new WebGrid(source: Data, rowsPerPage: 10);
}
@section Scripts {

}
@section Menu{
    @RenderPage("_Menu.cshtml")
}
@Html.Raw(Message)
<div class="col-lg-12">
    <h2 class="page-header">All Widgets | <a href="@Href("~/Admin/NewWidget")">Create Widget</a></h2>
    <p>Below are a list of all the current widgets on the site. Click <a href="@Href("~/Admin/AllPages")">HERE</a> to add them to a page.</p>
    <div class="table-responsive">
     @Grid.GetHtml(
                    tableStyle: "table table-bordered table-hover table-striped",
                    columns: Grid.Columns(
                        Grid.Column("Edit", format:@<text>@Html.Raw(Helpers.EditWidgetImg(item.Id,item.wFile))</text>),
                        Grid.Column("wName", "Widget Name"),
                        Grid.Column("Last Edited", format:@<i>@item.wEditDate</i>),
                        Grid.Column("Delete", format:@<text>@Html.Raw(Helpers.DeleteWidgetImg(item.Id, item.wFile))</text>)
                    )
                )
        <div class="col-sm-6">
            @Grid.PagerList(mode: WebGridPagerModes.All, paginationStyle: "pagination pagination-small pagination-right")
        </div>
    </div>
</div> 